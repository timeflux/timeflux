{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://schema.timeflux.io/app.json",
  "$ref": "#/definitions/app",

  "definitions": {

    "app": {
        "type": "object",
        "anyOf": [
          { "required": [ "import" ] },
          { "required": [ "graphs" ] }
        ],
        "properties": {
          "version": { "$ref": "#/definitions/version" },
          "import": { "$ref": "#/definitions/import" },
          "graphs": { "$ref": "#/definitions/graphs" }
        }
    },

    "version": {
      "type": "number",
      "default": 1.0
    },

    "import": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "string" ,
        "pattern": "\\.(json|yml|yaml)$"
      }
    },

    "graphs": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#definitions/graph" }
    },

    "graph": {
      "type": "object",
      "required": [
        "nodes"
      ],
      "properties": {
        "id": {
          "type": [
            "string",
            "null"
          ],
          "default": null,
          "pattern": "^[A-z0-9_-]+$",
          "examples": [
            "graph_id"
          ]
        },
        "rate": {
          "type": "number",
          "default": 1,
          "examples": [
            0,
            1,
            25
          ]
        },
        "nodes": { "$ref": "#definitions/nodes" },
        "edges": { "$ref": "#definitions/edges" }
      }
    },

    "nodes": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#definitions/node" }
    },

    "edges": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#definitions/edge" }
    },

    "node": {
      "$id": "node",
      "type": "object",
      "required": [
        "id",
        "module",
        "class"
      ],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[A-z0-9_-]+$",
          "examples": [
            "node_id"
          ]
        },
        "module": {
          "type": "string",
          "examples": [
            "timeflux.nodes.random"
          ],
          "pattern": "^[A-z0-9_-]+(\\.[A-z0-9_-]+)*$"
        },
        "class": {
          "type": "string",
          "examples": [
            "MyClass"
          ],
          "pattern": "^[A-Z_][a-zA-Z0-9]+$"
        },
        "params": {
          "type": "object",
          "default": {}
        }
      }
    },

    "edge": {
      "type": "object",
      "required": [
        "source",
        "target"
      ],
      "properties": {
        "source": {
          "type": "string",
          "default": "",
          "examples": [
            "node_id",
            "node_id:foo",
            "node_id:*"
          ],
          "pattern": "^[A-z0-9_-]+([:]{1}[A-z0-9_-]*\\*?)?$"
        },
        "target": {
          "type": "string",
          "default": "",
          "examples": [
            "node_id",
            "node_id:bar"
          ],
          "pattern": "^[A-z0-9_-]+([:]{1}[A-z0-9_-]+)?$"
        }
      }
    }

  }
}